<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Harmonizador Rápido — Buscar Pratos (TheMealDB)</title>
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial;max-width:980px;margin:28px auto;padding:18px;background:#f6f7fb;color:#111}
    header{display:flex;align-items:center;justify-content:space-between}
    h1{margin:0;font-size:1.2rem}
    .controls{display:flex;gap:8px;align-items:center;margin-top:12px}
    select,input,button{padding:8px;border:1px solid #d1d5db;border-radius:6px}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:12px;margin-top:18px}
    .card{background:#fff;padding:12px;border-radius:8px;box-shadow:0 1px 6px rgba(16,24,40,.06)}
    .thumb{height:160px;background:#f3f4f6;border-radius:6px;overflow:hidden;display:flex;align-items:center;justify-content:center}
    .thumb img{width:100%;height:100%;object-fit:cover}
    .muted{color:#6b7280;font-size:0.9rem}
    a.button-like{display:inline-block;padding:6px 10px;border-radius:6px;background:#2563eb;color:#fff;text-decoration:none}
  </style>
</head>
<body>
  <header>
    <div>
      <h1>Harmonizador Rápido</h1>
      <div class="muted">Busca pratos na web usando TheMealDB (API pública, chave de teste '1').</div>
    </div>
  </header>

  <div class="controls">
    <select id="wineSelect" style="min-width:360px"></select>
    <button id="btnSearch">Buscar Top 3</button>
    <button id="btnRandom">Buscar Aleatório</button>
  </div>

  <div id="status" class="muted" style="margin-top:10px"></div>

  <main id="results" class="grid" aria-live="polite" style="margin-top:14px"></main>

  <script>
    // Lista de vinhos (apenas nomes). Substitua/adicione conforme quiser.
    const WINES = [
      "Porta 6 Reserva",
      "Porta 6 Tinto",
      "Porta 6 Branco",
      "Brutalis by Vidigal",
      "Júlia Florista Tinto",
      "Da Pipa Tinto",
      "Vidigal Reserva",
      "Coragem Reserva",
      "3 Autores Douro",
      "Reserva dos Amigos"
    ];

    // TheMealDB base + test key
    const API_KEY = '1';
    const BASE = `https://www.themealdb.com/api/json/v1/${API_KEY}`;

    const wineSelect = document.getElementById('wineSelect');
    const btnSearch = document.getElementById('btnSearch');
    const btnRandom = document.getElementById('btnRandom');
    const results = document.getElementById('results');
    const status = document.getElementById('status');

    // Preencher select
    (function populate(){
      const optAll = document.createElement('option');
      optAll.value = '';
      optAll.textContent = '— selecione um rótulo (ou deixe em branco para aleatório) —';
      wineSelect.appendChild(optAll);
      for(const w of WINES){
        const o = document.createElement('option');
        o.value = w;
        o.textContent = w;
        wineSelect.appendChild(o);
      }
    })();

    // Helpers
    function setStatus(text){ status.textContent = text || ''; }
    function clearResults(){ results.innerHTML = ''; }

    function createCard(meal){
      const div = document.createElement('div');
      div.className = 'card';
      const thumb = meal.strMealThumb ? meal.strMealThumb : '';
      const name = meal.strMeal || '—';
      const id = meal.idMeal || '';
      const source = meal.strSource || meal.strYoutube || '#';
      div.innerHTML = `
        <div class="thumb"><img src="${thumb}" alt="${escapeHtml(name)}" onerror="this.src='data:image/svg+xml;utf8,${encodeURIComponent('<svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;600&quot; height=&quot;400&quot;><rect width=&quot;100%&quot; height=&quot;100%&quot; fill=&quot;#f3f4f6&quot;/><text x=&quot;50%&quot; y=&quot;50%&quot; dominant-baseline=&quot;middle&quot; text-anchor=&quot;middle&quot; fill=&quot;#9ca3af&quot; font-family=&quot;Arial&quot; font-size=&quot;18&quot;>Imagem não disponível</text></svg>')}"/></div>
        <h3 style="margin:8px 0 6px">${escapeHtml(name)}</h3>
        <div class="muted small">ID: ${escapeHtml(id)}</div>
        <div style="margin-top:8px"><a class="button-like" href="${source || '#'}" target="_blank" rel="noopener">Abrir receita</a></div>
      `;
      return div;
    }

    function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

    // Busca por nome (search.php?s=)
    async function searchByName(q){
      const url = `${BASE}/search.php?s=${encodeURIComponent(q)}`;
      setStatus('Buscando por nome: ' + q + ' ...');
      const res = await fetch(url);
      if(!res.ok) throw new Error('Erro na API');
      const json = await res.json();
      return json.meals; // array ou null
    }

    // Fallback: buscar por categoria (filter.php?c=Seafood)
    async function filterByCategory(cat){
      const url = `${BASE}/filter.php?c=${encodeURIComponent(cat)}`;
      setStatus('Fallback: buscando por categoria: ' + cat + ' ...');
      const res = await fetch(url);
      if(!res.ok) throw new Error('Erro na API');
      const json = await res.json();
      return json.meals; // array com id, name, thumb
    }

    // Lookup full meal by id (lookup.php?i=)
    async function lookupById(id){
      const url = `${BASE}/lookup.php?i=${encodeURIComponent(id)}`;
      const res = await fetch(url);
      if(!res.ok) throw new Error('Erro na API');
      const json = await res.json();
      return json.meals ? json.meals[0] : null;
    }

    // Seleciona top N (simples: primeiros N resultados)
    function pickTopN(arr, n=3){
      if(!Array.isArray(arr)) return [];
      return arr.slice(0, n);
    }

    // Fluxo principal: tenta search by name -> se null, fallback category Seafood
    async function findTop3ForWine(wineName){
      clearResults();
      try{
        setStatus('Iniciando busca...');
        // 1) tentar buscar por nome do vinho
        if(wineName){
          const byName = await searchByName(wineName);
          if(byName && byName.length){
            setStatus(`Encontradas ${byName.length} receitas por nome. Exibindo top 3.`);
            const top = pickTopN(byName, 3);
            for(const m of top){
              results.appendChild(createCard(m));
            }
            return;
          }
        }

